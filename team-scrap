#fonte: https://medium.freecodecamp.org/how-to-scrape-websites-with-python-and-beautifulsoup-5946935d93fe
#
#agradecimentos: Polez
#
#Run in cmd:
#   
#   pip install selenium
#   pip install beautifulsoup4

import re
import json
import sys
import urllib.parse
import colorama

from urllib.request import urlopen
from bs4 import BeautifulSoup

from colorama import init, AnsiToWin32
from colorama import Fore, Back, Style
from termcolor import colored, cprint



from selenium import webdriver
from selenium.webdriver.common.keys import Keys


def extractJson(teamName):

    #extract the player nicks in json into a list
    playerList = []
    with open ('data.json','r') as f:
        data = json.load(f)
    
    totalPlayers = len(data[teamName])
    for c in range(totalPlayers):
        playerList.append(data[teamName][c]["battlenet"])
        playerList[c] = playerList[c].replace("#","-")

    return playerList

def getStats(nick):
    #get the statistics of that player
    url = 'https://playoverwatch.com/pt-br/career/pc/' + urllib.parse.quote_plus(nick)
    # url do site
    quote_page = url
    #pegando o html
    page = urlopen(quote_page)
    #passando para um fomrato legivel
    soup = BeautifulSoup(page, 'html.parser')
    
    bestHero=''
    timeHero=''
    #verificando se Ã© perfil publico ou privado
    if soup.find('div', attrs={'class': 'ProgressBar-title'}) is not None:
        #PERFIL PBULICO

        #pegando o melhor heroi do jogador
        heroBox = soup.find('div', attrs={'class': 'ProgressBar-title'})
        bestHero  = heroBox.text.strip()

        #pegando o tempo de jogo do melhor heroi
        timeBox = soup.find('div', attrs={'class': 'ProgressBar-description'})
        timeHero = timeBox.text.strip() 

        #verificando se a pessoa joga ranked
        if soup.find('div', attrs={'class': 'competitive-rank'})is not None:

            #pegando o ranking do jogador
            name_box = soup.find('div', attrs={'class': 'competitive-rank'})
            rank = int(name_box.text.strip())

        else: 
            rank = "0000"
    else:  
        #PERFIL PRIVADO
        bestHero = 'Perfil Privado'
        timeHero = '00:00:00'
        rank = "0000"
        

    nick = nick.replace("-","#")
    print (rank ," - ", nick, ' - ', bestHero, '->', timeHero)


def main():
        
    print()


    teamName = 'inatel'
    playerList = extractJson(teamName)

    print (teamName,len(playerList),"jogadores" )

    print ('Rank  -  Nickname#12312  -  Best Hero -> Time Played')
    for c in range (len(playerList)):
        getStats(playerList[c])

main()

