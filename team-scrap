#fonte: https://medium.freecodecamp.org/how-to-scrape-websites-with-python-and-beautifulsoup-5946935d93fe
#
#agradecimentos: Polez
#
#Run in cmd:
#   
#   pip install selenium
#   pip install beautifulsoup4

import re
import json
import sys
import urllib.parse
import colorama

from urllib.request import urlopen
from bs4 import BeautifulSoup

from colorama import init, AnsiToWin32
from colorama import Fore, Back, Style
from termcolor import colored, cprint



from selenium import webdriver
from selenium.webdriver.common.keys import Keys


def extractJson(teamName):

    #extract the player nicks in json into a list
    playerList = []
    with open ('data.json','r') as f:
        data = json.load(f)
    
    totalPlayers = len(data[teamName])
    for c in range(totalPlayers):
        playerList.append(data[teamName][c]["battlenet"])
        playerList[c] = playerList[c].replace("#","-")

    return playerList

def getStats(nick):
    #get the statistics of that player
    url = 'https://playoverwatch.com/pt-br/career/pc/' + urllib.parse.quote_plus(nick)
    # url do site
    quote_page = url
    #pegando o html
    page = urlopen(quote_page)
    #passando para um fomrato legivel
    soup = BeautifulSoup(page, 'html.parser')
    #pegando a <div> do nome e pegando o seu valor
    if soup.find('div', attrs={'class': 'competitive-rank'})is not None:
        name_box = soup.find('div', attrs={'class': 'competitive-rank'})
        
        #pegando o ranking do jogador
        rank = int(name_box.text.strip())

    else: 
        rank = "0000"


    #pegando a <div> do nome e pegando o seu valor
    name_box = soup.find('h1', attrs={'class': 'header-masthead'})
    
    nick = nick.replace("-","#")
    print (rank ," - ", nick)

def main():
        
    print()


    teamName = input()
    playerList = extractJson(teamName)

    print (teamName,len(playerList),"jogadores" )

    print ('rank  -  nickname')
    for c in range (len(playerList)):
        getStats(playerList[c])

main()
